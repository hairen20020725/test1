# 🤖 AI推荐优化说明

## 优化目标

让AI在推荐空调方案时，**以知识库中的历史案例和对应解决方案为主**，而不是自由发挥创造新方案。

## 优化内容

### 1. 知识库结构调整

**文件**：`src/data/ac-products.ts`

#### 调整前
```
知识库结构：
1. 现有库存产品（第一部分）
2. 历史成功案例（第二部分）
3. 推荐原则（第三部分）
```

#### 调整后
```
知识库结构：
1. 历史成功案例（重点参考）- 第一部分，强调重要性
2. 现有库存产品 - 第二部分
3. 推荐原则（必须遵守）- 第三部分，明确优先级
```

#### 关键改进

1. **历史案例前置**
   - 将历史案例移到知识库最前面
   - 添加说明："这些方案都经过实际验证，获得了客户的好评"
   - 强调："请优先参考这些成功案例"

2. **案例信息增强**
   - 在产品配置中添加产品ID：`(产品ID: ${p.productId})`
   - 显示产品适用面积，便于AI匹配
   - 标注"经验总结（重要）"

3. **产品库说明优化**
   - 添加说明："请优先选择历史案例中已使用过的产品"
   - 明确替代策略："如果案例产品缺货，再考虑同品牌同系列的替代产品"

4. **推荐原则重构**
   - 标题改为"推荐原则（必须遵守）"
   - 第一条明确："历史案例优先"
   - 详细说明产品选择优先级（三级优先级）
   - 增加到10条原则，覆盖所有推荐场景

---

### 2. AI Prompt优化

**文件**：`src/pages/Home.tsx`

#### System Message优化

**调整前**：
```
你是一名专业的空调方案顾问，擅长根据户型图分析并提供个性化的空调配置方案。
你必须根据提供的产品知识库推荐具体的产品型号...
```

**调整后**：
```
你是一名经验丰富的空调方案顾问，擅长根据户型图分析并提供个性化的空调配置方案。
你的核心工作方法是：

1. 以历史案例为基础：优先从历史成功案例中寻找与当前户型相似的案例
2. 产品选择原则：优先推荐历史案例中已验证成功的产品
3. 经验传承：充分利用历史案例的经验总结、客户反馈和注意事项
4. 真实可靠：所有推荐的产品必须从知识库中选择
5. 专业详细：提供专业、详细、实用的建议

你的推荐应该让客户感受到这是基于大量成功案例总结出来的成熟方案，
而不是临时拼凑的方案。
```

#### User Prompt结构优化

**新增部分**：

```markdown
### 2. 相似案例参考
**重要：请先从历史案例中找出与当前户型最相似的案例（1-2个）**
- 列出相似案例的编号和标题
- 说明相似之处（面积、户型、朝向等）
- 总结该案例的解决方案和客户反馈
- 说明该案例的经验对当前户型的参考价值
```

**修改部分**：

```markdown
### 3. 整体方案建议
- **优先参考相似案例的方案类型**（中央空调/风管机+分体式/全分体式）
- 如果采用相似案例的方案，说明理由
- 如果需要调整，说明调整的原因

### 4. 具体产品推荐
**重要：优先使用历史案例中已验证成功的产品配置**

- **推荐理由**：
  - 如果是参考历史案例：说明在哪个案例中使用过，客户反馈如何
  - 如果是新推荐：说明为什么选择这款产品，与案例产品的对比
- **安装位置**：具体的安装位置建议（参考相似案例的安装经验）

### 5. 预算估算
- **与参考案例的预算对比**：说明预算差异及原因

### 6. 注意事项
- 参考相似案例的经验总结
- ...
```

**核心要求更新**：

```markdown
**核心要求**：
1. **必须优先参考历史案例**：找出最相似的案例，优先采用其产品配置方案
2. **产品选择原则**：
   - 第一优先：历史案例中已验证成功的产品
   - 第二优先：与案例产品同品牌同系列的产品
   - 第三优先：知识库中有库存的其他产品
3. **方案类型原则**：优先采用相似案例的方案类型，除非有充分理由调整
4. **必须使用真实产品**：所有推荐的产品必须从知识库中选择，包含正确的产品ID
5. **面积匹配**：确保推荐的产品适用面积与房间面积匹配
6. **库存优先**：优先推荐有库存的产品
7. **经验传承**：充分利用历史案例的经验总结和客户反馈
```

---

## 优化效果

### 优化前的AI行为
- ❌ 自由发挥，创造新的产品组合
- ❌ 不参考历史案例，每次推荐都不同
- ❌ 可能推荐知识库中不存在的产品
- ❌ 缺乏经验支撑，方案可信度低

### 优化后的AI行为
- ✅ 首先寻找相似的历史案例
- ✅ 优先采用案例中已验证的产品配置
- ✅ 明确说明参考了哪个案例
- ✅ 引用客户反馈和经验总结
- ✅ 方案更加成熟可靠，可信度高

---

## 推荐流程

### 新的AI推荐流程

```
1. 分析户型图
   ↓
2. 从历史案例中寻找相似案例
   - 比较面积（±20㎡）
   - 比较户型（房间数量）
   - 比较朝向
   - 比较建筑类型
   ↓
3. 选择1-2个最相似的案例
   ↓
4. 参考案例的方案类型
   - 中央空调
   - 风管机+分体式
   - 全分体式
   ↓
5. 参考案例的产品配置
   - 优先使用相同产品
   - 如缺货，选择同品牌同系列
   - 如无替代，选择相似规格产品
   ↓
6. 参考案例的安装经验
   - 安装位置
   - 注意事项
   ↓
7. 参考案例的预算范围
   ↓
8. 生成推荐方案
   - 明确标注参考的案例
   - 说明产品选择理由
   - 引用客户反馈
   - 总结经验教训
```

---

## 示例对比

### 优化前的推荐

```markdown
### 整体方案建议
推荐采用风管机+分体式方案...

### 具体产品推荐
#### 主卧
- 推荐产品：格力 KFR-35GW/NhGc1B
- 匹数：1.5匹
- 推荐理由：适合卧室使用，静音效果好
```

### 优化后的推荐

```markdown
### 相似案例参考
参考案例2：现代简约三居室空调方案
- 相似之处：
  - 面积相近（案例120㎡，当前户型115㎡）
  - 同为3室2厅户型
  - 都是南向主朝向
- 该案例采用风管机+分体式方案
- 客户反馈："制冷效果很好，噪音控制得当"
- 参考价值：户型结构相似，方案可直接借鉴

### 整体方案建议
**采用案例2的风管机+分体式方案**
- 理由：户型结构相似，该方案已在案例2中验证成功
- 客户反馈良好，性价比高

### 具体产品推荐
#### 主卧
- 推荐产品：格力 KFR-35GW/NhGc1B (产品ID: gree-split-1.5hp)
- 匹数：1.5匹
- 适用面积：12-18㎡
- 价格：¥3,299
- 推荐理由：
  - **在案例2中使用过**，客户反馈"卧室很安静，睡眠质量提高了"
  - 噪音仅22dB，非常适合卧室
  - 一级能效，长期使用省电
- 安装位置：床头对面墙壁（参考案例2的安装经验）
```

---

## 知识库优先级

### 产品选择优先级

```
第一优先：历史案例中已验证成功的产品
  ↓ 如果缺货
第二优先：与案例产品同品牌同系列的产品
  ↓ 如果没有
第三优先：知识库中有库存的其他产品
```

### 方案类型优先级

```
1. 相似案例的方案类型（最优先）
2. 根据面积调整的方案类型
3. 根据预算调整的方案类型
```

---

## 管理建议

### 如何提高推荐质量

1. **增加历史案例**
   - 进入管理后台 `/admin/cases`
   - 添加更多真实案例
   - 案例越多，AI匹配越准确

2. **完善案例信息**
   - 详细填写户型描述
   - 准确记录产品配置
   - 收集真实客户反馈
   - 总结经验教训

3. **保持产品库更新**
   - 及时更新库存状态
   - 添加新产品
   - 标注促销信息

4. **定期审查推荐结果**
   - 测试不同户型的推荐
   - 检查是否参考了历史案例
   - 验证产品ID是否正确

---

## 技术细节

### 修改的文件

1. **src/data/ac-products.ts**
   - `generateKnowledgeBaseFromDB()` 函数
   - 调整知识库结构
   - 优化推荐原则

2. **src/pages/Home.tsx**
   - System message
   - User prompt结构
   - 核心要求

### 代码变更统计

- 修改文件：2个
- 新增代码：约150行
- 修改代码：约80行
- 删除代码：约30行

---

## 测试建议

### 测试场景

1. **相似户型测试**
   - 上传与案例1相似的户型图（120㎡，3室2厅）
   - 检查AI是否引用了案例1
   - 检查是否使用了案例1的产品

2. **不同户型测试**
   - 上传与所有案例都不太相似的户型图
   - 检查AI如何选择参考案例
   - 检查产品选择逻辑

3. **产品缺货测试**
   - 将某个案例产品的库存设为0
   - 检查AI是否推荐替代产品
   - 检查替代逻辑是否合理

### 验证要点

- ✅ AI是否明确引用了历史案例
- ✅ 产品ID是否正确
- ✅ 是否优先使用案例中的产品
- ✅ 是否引用了客户反馈
- ✅ 是否参考了经验总结
- ✅ 预算是否参考了案例

---

## 常见问题

### Q1：AI还是没有参考历史案例怎么办？

**A**：可能的原因：
1. 历史案例太少（少于3个）
2. 案例与当前户型差异太大
3. AI模型理解偏差

**解决方案**：
1. 增加更多历史案例
2. 确保案例覆盖不同户型
3. 在prompt中进一步强调

### Q2：AI推荐了不存在的产品怎么办？

**A**：检查：
1. 产品知识库是否正确加载
2. 产品ID格式是否正确
3. 在prompt中强调必须包含产品ID

### Q3：如何让AI更严格地遵守案例？

**A**：可以进一步修改prompt：
- 在system message中增加"严格遵守"的表述
- 在核心要求中增加"不得自由发挥"
- 减少AI的创造空间

### Q4：案例太少怎么办？

**A**：
1. 添加更多真实案例
2. 可以基于现有产品创建典型案例
3. 至少保持5-10个案例覆盖常见户型

---

## 后续优化方向

### 短期优化（1-2周）
- [ ] 增加案例相似度计算逻辑
- [ ] 在前端显示参考的案例
- [ ] 添加"查看相似案例"功能

### 中期优化（1-2个月）
- [ ] 实现案例自动匹配算法
- [ ] 添加案例推荐置信度
- [ ] 收集用户反馈优化案例库

### 长期优化（3-6个月）
- [ ] 训练专用AI模型
- [ ] 实现案例自动学习
- [ ] 建立案例评分系统

---

**优化时间**：2025-11-27  
**优化状态**：✅ 已完成  
**代码检查**：✅ 通过  
**测试状态**：待测试
