# 🔧 故障排除指南

## 常见问题解决方案

### ❌ 错误：`acProducts is not defined`

**问题描述**：
浏览器控制台显示 `Uncaught ReferenceError: acProducts is not defined`

**原因**：
这是浏览器缓存问题。代码已经更新，但浏览器仍在使用旧版本的缓存文件。

**解决方案**：

#### 方法1：硬刷新浏览器（推荐）

1. **Windows/Linux**：
   - Chrome/Edge: 按 `Ctrl + Shift + R` 或 `Ctrl + F5`
   - Firefox: 按 `Ctrl + Shift + R` 或 `Ctrl + F5`

2. **Mac**：
   - Chrome/Edge: 按 `Cmd + Shift + R`
   - Firefox: 按 `Cmd + Shift + R`
   - Safari: 按 `Cmd + Option + R`

#### 方法2：清除浏览器缓存

1. 打开浏览器开发者工具（F12）
2. 右键点击刷新按钮
3. 选择"清空缓存并硬性重新加载"

#### 方法3：清除应用缓存（开发环境）

如果您在开发环境中，可以运行：

```bash
# 清除Vite缓存
rm -rf .vite node_modules/.vite dist

# 重新启动开发服务器
npm run dev
```

### ✅ 验证修复

刷新后，您应该能够：
- ✅ 正常访问首页
- ✅ 看到产品列表（从数据库加载）
- ✅ 点击"管理后台"按钮
- ✅ 上传户型图并获取AI推荐

### 📝 技术说明

**代码已修复**：
- ❌ 旧代码：使用硬编码的 `acProducts` 数组
- ✅ 新代码：从数据库动态加载 `products` 状态

**修改内容**：
```typescript
// 旧代码（已删除）
import { acProducts } from '@/data/ac-products';

// 新代码
const [products, setProducts] = useState<ACProduct[]>([]);

useEffect(() => {
  loadData();
}, []);

const loadData = async () => {
  const productsData = await getAllProducts();
  setProducts(productsData);
};
```

---

## 其他常见问题

### 问题：页面加载缓慢

**解决方案**：
- 检查网络连接
- 确保Supabase数据库连接正常
- 查看浏览器控制台是否有错误信息

### 问题：产品列表为空

**可能原因**：
1. 数据库连接失败
2. 数据未正确插入

**解决方案**：
1. 检查 `.env` 文件中的Supabase配置
2. 确认数据库迁移已成功执行
3. 在管理后台手动添加产品

### 问题：AI推荐失败

**可能原因**：
1. 未上传户型图
2. AI服务连接失败
3. 数据库中没有产品数据

**解决方案**：
1. 确保已上传户型图
2. 检查网络连接
3. 在管理后台添加产品数据

### 问题：无法访问管理后台

**解决方案**：
1. 确认URL路径正确：`/admin`
2. 检查路由配置是否正确
3. 清除浏览器缓存后重试

---

## 🆘 获取帮助

如果以上方法都无法解决问题，请：

1. 📋 查看浏览器控制台的完整错误信息
2. 📖 查看项目文档：
   - `README.md` - 项目说明
   - `TODO.md` - 开发进度
   - `ADMIN_GUIDE.md` - 管理后台使用指南
   - `QUICK_START.md` - 快速入门
3. 💬 提交问题反馈，包含：
   - 错误截图
   - 浏览器版本
   - 操作步骤

---

## 📝 案例管理问题

### ❌ 问题：上传户型图后无法保存

**问题描述**：
在案例添加/编辑表单中，上传户型图后点击保存，案例无法保存成功。

**原因**：
这是一个已知的bug，在编辑模式下，如果没有上传新图片，系统会错误地清空原有的图片URL。

**解决方案**：

✅ **此问题已修复**（2025-11-27）

修复内容：
- 添加了`existingImageUrl`状态来保存原有图片URL
- 修改了提交逻辑，正确处理图片URL
- 编辑时不修改图片会保留原有图片

**现在的行为**：
- ✅ 添加案例时可以上传图片
- ✅ 编辑案例时可以保留原图片
- ✅ 编辑案例时可以更换新图片
- ✅ 完整的文件验证和错误提示

**测试步骤**：
1. 进入案例管理 `/admin/cases`
2. 点击"添加案例"或"编辑"按钮
3. 上传户型图（JPG/PNG/WEBP，小于1MB）
4. 填写其他必填字段
5. 点击"添加案例"或"更新案例"
6. ✅ 预期：案例保存成功，图片正常显示

**详细说明**：
查看 `IMAGE_UPLOAD_FIX.md` 获取完整的修复说明和测试指南。

### ❌ 问题：图片上传失败

**可能原因**：

#### 1. 文件格式不支持
**错误提示**：`仅支持JPG、PNG、WEBP格式`

**解决方案**：
- 确保文件格式为JPG、PNG或WEBP
- 使用图片编辑软件转换格式

#### 2. 文件大小超限
**错误提示**：`文件大小不能超过1MB`

**解决方案**：
- 使用在线压缩工具（如tinypng.com）
- 使用图片编辑软件调整大小
- 建议分辨率：800x600到1200x900

#### 3. 文件名包含中文
**错误提示**：`文件名不能包含中文字符`

**解决方案**：
- 重命名文件为英文名称
- 示例：`floor_plan_001.jpg`
- 避免：`户型图.jpg`

#### 4. Supabase Storage权限问题
**错误提示**：`图片上传失败`

**解决方案**：
1. 检查Supabase Storage是否正常运行
2. 确认存储桶`app-7ua9s9vs9fr5_floor_plans`存在
3. 检查存储桶权限设置为公开读取

**验证存储桶**：
```sql
-- 在Supabase SQL编辑器中运行
SELECT * FROM storage.buckets WHERE name = 'app-7ua9s9vs9fr5_floor_plans';
```

### ❌ 问题：案例列表不显示图片

**可能原因**：

#### 1. 图片URL无效
**解决方案**：
1. 检查数据库中的`floor_plan_image`字段
2. 确认URL格式正确
3. 在浏览器中直接访问URL测试

#### 2. 存储桶权限问题
**解决方案**：
1. 登录Supabase控制台
2. 进入Storage → `app-7ua9s9vs9fr5_floor_plans`
3. 确认"Public"选项已启用

#### 3. 图片已被删除
**解决方案**：
- 重新上传图片
- 或编辑案例清空图片字段

---

**最后更新**：2025-11-27
